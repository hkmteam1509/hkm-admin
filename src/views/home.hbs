{{#section 'head'}}
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>HKM admin</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- favicon
		============================================ -->
    <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico">
    <!-- Google Fonts
		============================================ -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,700,900" rel="stylesheet">
    <!-- Bootstrap CSS
		============================================ -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <!-- Bootstrap CSS
		============================================ -->
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <!-- owl.carousel CSS
		============================================ -->
    <link rel="stylesheet" href="/css/owl.carousel.css">
    <link rel="stylesheet" href="/css/owl.theme.css">
    <link rel="stylesheet" href="/css/owl.transitions.css">
    <!-- animate CSS
		============================================ -->
    <link rel="stylesheet" href="/css/animate.css">
    <!-- normalize CSS
		============================================ -->
    <link rel="stylesheet" href="/css/normalize.css">
    <!-- meanmenu icon CSS
		============================================ -->
    <link rel="stylesheet" href="/css/meanmenu.min.css">
    <!-- main CSS
		============================================ -->
    <link rel="stylesheet" href="/css/main.css">
    <!-- educate icon CSS
		============================================ -->
    <link rel="stylesheet" href="/css/educate-custon-icon.css">
    <!-- morrisjs CSS
		============================================ -->
    <link rel="stylesheet" href="/css/morrisjs/morris.css">
    <!-- mCustomScrollbar CSS
		============================================ -->
    <link rel="stylesheet" href="/css/scrollbar/jquery.mCustomScrollbar.min.css">
    <!-- metisMenu CSS
		============================================ -->
    <link rel="stylesheet" href="/css/metisMenu/metisMenu.min.css">
    <link rel="stylesheet" href="/css/metisMenu/metisMenu-vertical.css">
    <!-- calendar CSS
		============================================ -->
    <link rel="stylesheet" href="/css/calendar/fullcalendar.min.css">
    <link rel="stylesheet" href="/css/calendar/fullcalendar.print.min.css">
    <!-- x-editor CSS
		============================================ -->
    <link rel="stylesheet" href="/css/editor/select2.css">
    <link rel="stylesheet" href="/css/editor/datetimepicker.css">
    <link rel="stylesheet" href="/css/editor/bootstrap-editable.css">
    <link rel="stylesheet" href="/css/editor/x-editor-style.css">
    <!-- normalize CSS
        ============================================ -->
    <link rel="stylesheet" href="/css/data-table/bootstrap-table.css">
    <link rel="stylesheet" href="/css/data-table/bootstrap-editable.css">
    <!-- style CSS
		============================================ -->
    <link rel="stylesheet" href="/style.css">
    <!-- responsive CSS
		============================================ -->
    <link rel="stylesheet" href="/css/responsive.css">
    <!-- modernizr JS
		============================================ -->
    <script src="/js/vendor/modernizr-2.8.3.min.js"></script>
    <!-- MY CSS
		============================================ -->
    <link rel="stylesheet" href="/css/my-css.css">
{{/section}}

 <div class="product-sales-area mg-tb-30">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-8 col-md-12 col-sm-12 col-xs-12">
                <div class="product-sales-chart">
                    <div class="portlet-title" style="margin: 10px 0">
                        <div class="row">
                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                {{!-- <h4>Sales by
                                    <a href="#" id="group" data-type="select" data-pk="1" data-value="0" data-source="/peridos" data-title="Select group">Year</a>
                                </h4> --}}
                                <div class="row">
                                    <div class="col-xs-3">
                                        <h4 style="margin-top: 10px !important; display: inline-block">Sales by:</h4>
                                    </div>
                                    <div class="col-xs-5">
                                        <select onchange="startSubmitStatitic(this)" id="statiticBy1" class="form-control" name="statiticBy1">
                                            <option value="0">Year</option>
                                            <option value="1">Quarter</option>
                                            <option value="2">Month</option>
                                            <option value="3">Week</option>
                                        </select>
                                    </div>
                                     <div class="col-xs-4">
                                        <select onchange="startSubmitStatitic(this)"  id="statiticBy2" class="form-control" name="statiticBy2">
                                            <option value="0">All</option>
                                            <option value="1">Brand</option>
                                            <option value="2">Gender</option>
                                            <option value="3">Category</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                <div class="actions graph-rp graph-rp-dl">
                                    <p>All Earnings are in $</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <ul class="list-inline cus-product-sl-rp" id="filter-color">
                        
                    </ul>
                    <div id="extra-area-chart" style="height: 356px;"></div>
                </div>
            </div>
            <div class="col-lg-4 col-md-12 col-sm-12 col-xs-12">
                <div class="data-table-area mg-b-15">
                    <div class="sparkline13-list">
                        <div class="sparkline13-hd">
                            <div class="main-sparkline13-hd">
                                <h4>Sales <span class="table-project-n">Data</span> Table</h4>
                            </div>
                        </div>
                        <div class="sparkline13-graph">
                            <div class="datatable-dashv1-list custom-datatable-overright">
                                {{!-- <div id="toolbar">
                                    <select class="form-control dt-tb">
                                        <option value="">Export Basic</option>
                                        <option value="all">Export All</option>
                                        <option value="selected">Export Selected</option>
                                    </select>
                                </div> --}}
                                {{!-- <table id="table" data-toggle="table" data-pagination="false" data-search="false" data-show-columns="false" data-show-pagination-switch="false" data-show-refresh="false" data-key-events="true" data-show-toggle="false" data-resizable="true" data-cookie="true"
                                    data-cookie-id-table="saveId" data-show-export="true" data-click-to-select="true" data-toolbar="#toolbar"> --}}
                                    <table  id="table">
                                    <thead id="table-head">
                                        <tr>
                                            {{!-- <th data-field="state" data-checkbox="true"></th> --}}
                                            <th data-field="year" data-editable="false">Year</th>
                                            <th data-field="Sales" data-editable="false">Sales</th>
                                        </tr>
                                    </thead>
                                    <tbody id="table-body">
                                        {{#each statiticData}}
                                            <tr>
                                                {{!-- <td></td> --}}
                                                <td>{{this.year}}</td>
                                                <td>{{this.value}}</td>
                                            </tr>
                                        {{/each}}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>    
            </div>
        </div>
    </div>
</div>
<div class="library-book-area mg-t-30">
    <div class="container-fluid">
        <div class="row" id="my-container">
            <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12">
                <div class="single-product-item res-mg-t-30 table-mg-t-pro-n tb-sm-res-d-n dk-res-t-d-n" >
                    {{!-- <h4>Best Sellings of <a href="#" id="group1" data-type="select" data-pk="1" data-value="0" data-source="/brands" data-title="Select group">All</a></h4> --}}
					<h4 style="margin-top: 10px !important; display: inline-block">Best Sellings of:</h4>
                    <form method="get"  style="display: inline-block;">
                        <select onchange="startSubmit(this)" class="form-control" name="brand">
                        <option value="0">All</option>
                            {{#each brands}}
                                {{#if ../selectBrandQuery}}
                                    {{#isEqual this.brandID ../selectBrandQuery}}
                                        <option value="{{this.brandSlug}}" selected = "">{{this.brandName}}</option>
                                    {{else}}
                                        <option value="{{this.brandSlug}}">{{this.brandName}}</option>
                                    {{/isEqual}}
                                {{else}}
                                    <option value="{{this.brandSlug}}">{{this.brandName}}</option>
                                {{/if}}
                            {{/each}}
                        </select>
                    </form>
                    <div id="my-best-product-container">
                        {{#if bestProduct}}
                            <div class="single-product-image" style="margin-top: 20px;">
                                <img src="{{bestProduct.image}}" alt="{{bestProduct.proName}}">
                            </div>
                            <div class="single-product-text edu-pro-tx">
                                <h4><a href="/products/view/1">{{bestProduct.proName}}</a></h4>
                                <h5>{{bestProduct.description}}</h5>
                                <div class="product-price">
                                    <h3>${{bestProduct.price}}</h3>
                                    <div class="single-item-rating">
                                        {{bestProduct.sold}} sold
                                    </div>
                                </div>
                            </div>
                        {{/if}}
                    </div>
                </div>
            </div>

            {{#if firstProducts}}
                <div class="col-lg-4 col-md-6 col-sm-6 col-xs-12">
                    <div class="single-review-st-item res-mg-t-30 table-mg-t-pro-n">
                        <div class="single-review-st-hd">
                            <h2>Top Sellings</h2>
                        </div>
                        <div id="first-product-container">
                            {{#each firstProducts}}
                                <div class="single-review-st-text">
                                    <img src="{{this.image}}" alt="{{this.proName}}">
                                    <div class="review-ctn-hf">
                                        <h3><b>{{this.No}}. </b>{{this.proName}}</h3>
                                        <p>${{this.price}}</p>
                                    </div>
                                    <div class="review-item-rating">
                                        {{this.sold}} sold
                                    </div>
                                </div>
                            {{/each}}
                        </div>
                       
                    </div>
                </div>
            {{/if}}
            {{#if lastProducts}}
                <div class="col-lg-4 col-md-6 col-sm-6 col-xs-12">
                    <div class="single-review-st-item res-mg-t-30 table-mg-t-pro-n">
                        <div class="single-review-st-hd">
                            <h2>Top Sellings</h2>
                        </div>
                        <div id="last-product-container">
                            {{#each lastProducts}}
                                <div class="single-review-st-text">
                                    <img src="{{this.image}}" alt="{{this.proName}}">
                                    <div class="review-ctn-hf">
                                        <h3><b>{{this.No}}. </b>{{this.proName}}</h3>
                                        <p>${{this.price}}</p>
                                    </div>
                                    <div class="review-item-rating">
                                        {{this.sold}} sold
                                    </div>
                                </div>
                            {{/each}}
                        </div>
                       
                    </div>
                </div>
            {{/if}}
        </div>
    </div>
</div>

 {{#section 'script'}}
<!-- jquery
		============================================ -->
    <script src="/js/vendor/jquery-1.12.4.min.js"></script>
    <!-- bootstrap JS
		============================================ -->
    <script src="/js/bootstrap.min.js"></script>
    <!-- wow JS
		============================================ -->
    <script src="/js/wow.min.js"></script>
    <!-- price-slider JS
		============================================ -->
    <script src="/js/jquery-price-slider.js"></script>
    <!-- meanmenu JS
		============================================ -->
    <script src="/js/jquery.meanmenu.js"></script>
    <!-- owl.carousel JS
		============================================ -->
    <script src="/js/owl.carousel.min.js"></script>
    <!-- sticky JS
		============================================ -->
    <script src="/js/jquery.sticky.js"></script>
    <!-- scrollUp JS
		============================================ -->
    <script src="/js/jquery.scrollUp.min.js"></script>
    <!-- counterup JS
		============================================ -->
    <script src="/js/counterup/jquery.counterup.min.js"></script>
    <script src="/js/counterup/waypoints.min.js"></script>
    <script src="/js/counterup/counterup-active.js"></script>
    <!-- mCustomScrollbar JS
		============================================ -->
    <script src="/js/scrollbar/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="/js/scrollbar/mCustomScrollbar-active.js"></script>
    <!-- metisMenu JS
		============================================ -->
    <script src="/js/metisMenu/metisMenu.min.js"></script>
    <script src="/js/metisMenu/metisMenu-active.js"></script>
    <!-- data table JS
		============================================ -->
    {{!-- <script src="/js/data-table/bootstrap-table.js"></script>--}}
    {{!-- <script src="/js/data-table/tableExport.js"></script> --}}
    {{!-- <script src="/js/data-table/data-table-active.js"></script> --}}
    {{!-- <script src="/js/data-table/bootstrap-table-editable.js"></script> --}}
    {{!-- <script src="/js/data-table/bootstrap-editable.js"></script> --}}
    {{!-- <script src="/js/data-table/bootstrap-table-resizable.js"></script> --}}
    {{!-- <script src="/js/data-table/colResizable-1.5.source.js"></script> --}}
    {{!-- <script src="/js/data-table/bootstrap-table-export.js"></script>  --}}

    <script src="https://unpkg.com/bootstrap-table@1.19.1/dist/bootstrap-table.min.js"></script>

    <!--  editable JS
        ============================================ -->
    <script src="/js/editable/jquery.mockjax.js"></script>
    <script src="/js/editable/mock-active.js"></script>
    <script src="/js/editable/select2.js"></script>
    <script src="/js/editable/moment.min.js"></script>
    <script src="/js/editable/bootstrap-datetimepicker.js"></script>
    <script src="/js/editable/bootstrap-editable.js"></script>
    <script src="/js/editable/xediable-active.js"></script>
    <!-- Chart JS
        ============================================ -->
    <script src="/js/chart/jquery.peity.min.js"></script>
    <script src="/js/peity/peity-active.js"></script>
    <!-- tab JS
        ============================================ -->
    <script src="/js/tab.js"></script>
    <!-- morrisjs JS
		============================================ -->
    <script src="/js/morrisjs/raphael-min.js"></script>
    <script src="/js/morrisjs/morris.js"></script>
    {{!-- <script src="/js/morrisjs/morris-active.js"></script> --}}
    <!-- morrisjs JS
		============================================ -->
    <script src="/js/sparkline/jquery.sparkline.min.js"></script>
    <script src="/js/sparkline/jquery.charts-sparkline.js"></script>
    <script src="/js/sparkline/sparkline-active.js"></script>
    <!-- calendar JS
		============================================ -->
    <script src="/js/calendar/moment.min.js"></script>
    <script src="/js/calendar/fullcalendar.min.js"></script>
    <script src="/js/calendar/fullcalendar-active.js"></script>
    <!-- plugins JS
		============================================ -->
    <script src="/js/plugins.js"></script>
    <!-- main JS
		============================================ -->
    <script src="/js/main.js"></script>
    <!-- tawk chat JS
		============================================ -->
    <!-- <script src="/js/tawk-chat.js"></script> -->
    <script>
        $(document).ready(function(){
            const statiticData = {{{json statiticData}}};
            $("#table").bootstrapTable();
            Morris.Area({
                element: "extra-area-chart",
                data: statiticData,
                xkey: 'year',
                ykeys: ['value'],
                labels: ['Sales'],
                pointSize: 3,
                fillOpacity: 0,
                behaveLikeLine: true,
                gridLineColor: '#e0e0e0',
                lineWidth: 1,
                hideHover: 'auto',
                resize: true
            })
        });

        const colors = ["#FF1616", "#FF914D", "#FFDE59", "#7ED957", "#5271FF", "#8C52FF", "#7F00FF"];

        function bestProductView(bestProduct){
            if(bestProduct){
                return `
                    <div class="single-product-image" style="margin-top: 20px;">
                        <img src="${bestProduct.image}" alt="${bestProduct.proName}">
                    </div>
                    <div class="single-product-text edu-pro-tx">
                        <h4><a href="/products/view/1">${bestProduct.proName}</a></h4>
                        <h5>${bestProduct.description}</h5>
                        <div class="product-price">
                            <h3>$${bestProduct.price}</h3>
                            <div class="single-item-rating">
                                ${bestProduct.sold} sold
                            </div>
                        </div>
                    </div>
                `
            }else{
                return ``;
            }
        }

        function productView(products){
            return products.map(pro=>{
               if(pro){
                    return `
                        <div class="single-review-st-text">
                            <img src="${pro.image}" alt="${pro.proName}">
                            <div class="review-ctn-hf">
                                <h3><b>${pro.No}. </b>${pro.proName}</h3>
                                <p>\$${pro.price}</p>
                            </div>
                            <div class="review-item-rating">
                                ${pro.sold} sold
                            </div>
                        </div>
                    `
               }else{
                   return ``;
               }
            })
        }

        function startSubmit(ele){
            const value = ele.value;
            $.ajax({
                method:'get',
                url: '/best-selling',
                data:{
                    brand: value
                },
                success: function(data){
                    $("#my-best-product-container").empty();
                    $("#my-best-product-container").append(bestProductView(data.bestProduct));
                    $("#first-product-container").empty();
                    $("#first-product-container").append(productView(data.firstProducts).join(""));
                    $("#last-product-container").empty();
                    $("#last-product-container").append(productView(data.lastProducts).join(""));
                },
                error: function(err){
                    console.log(err);
                    alert("An error has occurred, please try again");
                }
            })
        }
    
        function startSubmitStatitic(ele){
            const value = $("#statiticBy1").val();
            const value1 = $("#statiticBy2").val();
            $.ajax({
                url: "/statitics",
                method: 'get',
                data:{
                    type: value,
                    type1: value1,
                },
                success: function(data){
                    console.log(data);
                    const type = parseInt(value);
                    const type1 = parseInt(value1);
                    let xkey = 'year';
                    let ykeys = ['value'];
                    let labels = ['Sales'];
                    $("#filter-color").empty();
                    $("#extra-area-chart").empty();
                    let tableColumn = [];
                    let tableData = [];
                    const myColors = [];
                    if(type === 0){
                       xkey = 'year';
                    }else if (type === 1){
                         xkey = 'quarter';
                    }else if(type === 2){
                        xkey = 'month';
                    }else if(type === 3){
                        xkey = 'week';
                    }
                    tableColumn.push({
                        field: xkey,    
                        title: xkey.charAt(0).toUpperCase() + xkey.slice(1)
                    })
                  
                    if(type1 === 0){
                        myColors.push(colors[4]);
                        tableColumn.push({
                            field: 'value',
                            title: 'Sales'
                        })
                        
                    }
                    else if (type1 === 1){
                        let colorIndex = 0;
                        ykeys = data.brands.map(brand=>{
                            if(colorIndex >= 7){
                                colorIndex = 0;
                            }
                            myColors.push(colors[colorIndex]);
                            colorIndex++;
                            return brand.brandName;
                        });
                        labels = data.brands.map(brand=>{
                            tableColumn.push({
                                field: brand.brandName,
                                title: brand.brandName
                            });
                            return brand.brandName;
                        });
                        let colorView = ``;
                        data.brands.forEach((brand, index)=>{
                            
                            colorView += `
                                <li>
                                    <h5><i class="fa fa-circle" style="color: ${myColors[index]};"></i>${brand.brandName}</h5>
                                </li>`;
                        });
                        
                        $("#filter-color").append(colorView);
                    }
                    else if(type1 === 2){
                        let colorIndex = 0;
                        ykeys = data.genders.map(gender=>{
                            if(colorIndex >= 7){
                                colorIndex = 0;
                            }
                            myColors.push(colors[colorIndex]);
                            colorIndex++;
                           
                            return gender.genderName;
                        });
                        labels = data.genders.map(gender=>{
                            tableColumn.push({
                                field: gender.genderName,
                                title: gender.genderName
                            });
                            return gender.genderName;
                        });
                        let colorView = ``;
                        data.genders.forEach((gender, index)=>{
                            colorView += `
                                <li>
                                    <h5><i class="fa fa-circle" style="color: ${myColors[index]};"></i>${gender.genderName}</h5>
                                </li>`;
                        });
                       
                        $("#filter-color").append(colorView);
                    }
                    else if(type1 === 3){
                        let colorIndex = 0;
                        ykeys = data.cats.map(cat=>{
                            if(colorIndex >= 7){
                                colorIndex = 0;
                            }
                            myColors.push(colors[colorIndex]);
                            colorIndex++;
                            return cat.catName;
                        });
                        labels = data.cats.map(cat=>{
                            tableColumn.push({
                                field: cat.catName,
                                title: cat.catName
                            });
                            return cat.catName;
                        });
                        let colorView = ``;
                        data.cats.forEach((cat, index)=>{
                            colorView += `
                                <li>
                                    <h5><i class="fa fa-circle" style="color: ${myColors[index]};"></i>${cat.catName}</h5>
                                </li>`;
                        });
                        $("#filter-color").append(colorView);
                    }
                    data.statiticData.forEach(row=>{
                        tableData.push(JSON.parse(JSON.stringify(row)));
                    });
                    $("#table").bootstrapTable("destroy");
                  
                    $("#table").bootstrapTable({
                        columns: JSON.parse(JSON.stringify(tableColumn)),
                        data: JSON.parse(JSON.stringify(tableData)),
                    });
                    Morris.Area({
                        element: "extra-area-chart",
                        data: data.statiticData,
                        xkey: xkey,
                        ykeys: ykeys,
                        labels: labels,
                        pointSize: 3,
                         pointStrokeColors:myColors,
                        fillOpacity: 0,
                        lineColors: myColors,
                        behaveLikeLine: true,
                        gridLineColor: '#e0e0e0',
                        lineWidth: 1,
                        hideHover: 'auto',
                        resize: true
                    })
                },
                error: function(err){
                    console.log(err);
                    alert("An error has occurred, please try again");
                }
            })
        }
    </script>
 {{/section}}